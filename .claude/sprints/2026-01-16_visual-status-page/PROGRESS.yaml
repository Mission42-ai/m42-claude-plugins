sprint-id: 2026-01-16_visual-status-page
status: in-progress
phases:
  - id: prepare
    status: completed
    prompt: |
      Create a sprint architecture plan that will guide implementation and QA verification.

      ## Your Task
      Analyze all steps in this sprint and create a comprehensive plan document.

      ## Instructions
      1. Read the SPRINT.yaml to understand all planned steps
      2. Research the existing codebase to understand:
         - Current architecture in plugins/m42-sprint/
         - Existing types in compiler/src/types.ts
         - Existing patterns in compiler/src/*.ts
         - Shell script patterns in scripts/*.sh
      3. Create a plan that documents:
         - Overall sprint goal (what we're building and why)
         - Architecture overview (how new components fit together)
         - Integration points (how new code connects to existing code)
         - Per-step success criteria (what "done" looks like for each step)
         - Dependencies between steps
         - Risk areas or potential issues

      ## Output
      Write the plan to: context/sprint-plan.md

      ## Plan Template
      ```markdown
      # Sprint Plan: [Sprint Name]

      ## Goal
      [One paragraph describing what this sprint accomplishes]

      ## Architecture Overview
      [Diagram or description of how components fit together]

      ## Integration Points
      - [List how new code connects to existing code]

      ## Step Success Criteria

      ### Step 1: [Step name]
      - [ ] [Specific success criterion]
      - [ ] [Integration requirement]

      ### Step 2: ...

      ## Dependencies
      [Which steps depend on others]

      ## Risk Areas
      [Potential issues to watch for]
      ```
    started-at: "2026-01-16T10:32:57Z"
    completed-at: "2026-01-16T10:35:08Z"
    elapsed: 00:02:11
  - id: execute-all
    status: in-progress
    steps:
      - id: step-0
        prompt: |
          Create TypeScript interfaces for status events and server config.

          File: compiler/src/status-server/status-types.ts

          Requirements:
          - StatusUpdate interface with sprint state, phase tree, current task
          - LogEntry interface for activity feed entries
          - ServerConfig interface with port, host, sprint directory
          - SSE event types (status-update, log-entry, keep-alive)
        status: completed
        phases:
          - id: implement
            status: completed
            prompt: |
              Execute the following task:

              Create TypeScript interfaces for status events and server config.

              File: compiler/src/status-server/status-types.ts

              Requirements:
              - StatusUpdate interface with sprint state, phase tree, current task
              - LogEntry interface for activity feed entries
              - ServerConfig interface with port, host, sprint directory
              - SSE event types (status-update, log-entry, keep-alive)


              ## Before Starting
              1. Read context/sprint-plan.md to understand:
                 - How this step fits into the overall sprint goal
                 - Architecture decisions that affect this step
                 - Success criteria for this specific step
                 - Dependencies on previous steps

              ## Implementation Guidelines
              - Follow existing patterns in the codebase
              - Keep code simple and focused on the task
              - Make atomic commits for logical units of work
              - If blocked or unclear, set status to needs-human

              ## Complete this task fully before marking as done.
            started-at: "2026-01-16T10:35:31Z"
            completed-at: "2026-01-16T11:36:00Z"
            elapsed: 01:00:29
          - id: qa
            status: completed
            prompt: |
              Quality Assurance verification for the m42-sprint plugin.

              ## Context
              Step: step-0
              Task: Create TypeScript interfaces for status events and server config.

              File: compiler/src/status-server/status-types.ts

              Requirements:
              - StatusUpdate interface with sprint state, phase tree, current task
              - LogEntry interface for activity feed entries
              - ServerConfig interface with port, host, sprint directory
              - SSE event types (status-update, log-entry, keep-alive)


              ## Step 1: Run QA Checks

              ### TypeScript (if compiler/ was modified)
              ```bash
              cd plugins/m42-sprint/compiler && npm run build
              ```
              - Build completes without errors
              - New code integrates with existing types

              ### Shell Scripts (if scripts/ was modified)
              ```bash
              bash -n plugins/m42-sprint/scripts/<script>.sh
              ```
              - Script syntax is valid

              ### Commands/Workflows (if modified)
              - YAML syntax valid (use yq to verify)
              - Template variables correct

              ### Integration
              - Matches architecture in context/sprint-plan.md
              - Follows existing codebase patterns
              - No breaking changes

              ### Smoke Test
              - Manually verify the implementation works

              ## Step 2: Write QA Report

              Write report to: artifacts/step-0-qa-report.md

              ```markdown
              # QA Report: step-0

              ## Checks Performed
              | Check | Result | Details |
              |-------|--------|---------|
              | TypeScript build | PASS/FAIL/SKIP | ... |
              | Script validation | PASS/FAIL/SKIP | ... |
              | Integration | PASS/FAIL | ... |
              | Smoke test | PASS/FAIL | ... |

              ## Issues Found
              1. [Issue description]
              2. [Issue description]

              ## Status: PASS / FAIL
              ```

              ## Step 3: Handle Outcome

              ### If ALL checks PASS:
              - Ensure QA report shows "Status: PASS"
              - Mark this phase as completed
              - Done!

              ### If ANY check FAILS:
              You MUST inject fix tasks into PROGRESS.yaml. Do NOT just report issues.

              1. Ensure QA report shows "Status: FAIL" with specific issues listed

              2. Determine the sprint directory (where PROGRESS.yaml lives):
                 ```bash
                 # The sprint directory is the parent of context/ and artifacts/
                 SPRINT_DIR=$(dirname "$(pwd)/artifacts" 2>/dev/null || echo ".")
                 # Or find it from PROGRESS.yaml location
                 PROGRESS_FILE=$(find .claude/sprints -name "PROGRESS.yaml" -newer .claude/sprints/*/SPRINT.yaml 2>/dev/null | head -1)
                 ```

              3. Insert fix + verify phases using yq:
                 ```bash
                 # Add fix-qa and verify-qa phases after the current qa phase
                 yq -i '
                   (.phases[] | select(.steps) | .steps[] | select(.status == "in-progress")).phases +=
                   [
                     {
                       "id": "fix-qa",
                       "status": "pending",
                       "prompt": "Fix the QA issues identified in artifacts/step-0-qa-report.md.\n\nInstructions:\n1. Read the QA report carefully\n2. Fix each identified issue\n3. Re-run the failed checks to confirm fixes\n4. Update artifacts/step-0-qa-report.md with fix status"
                     },
                     {
                       "id": "verify-qa",
                       "status": "pending",
                       "prompt": "Verify all QA issues from step-0 are resolved.\n\nRe-run ALL checks from the original QA:\n- TypeScript build (if applicable)\n- Script validation (if applicable)\n- Integration verification\n- Smoke test\n\nUpdate artifacts/step-0-qa-report.md with final PASS status.\nIf still failing, inject another fix-qa phase."
                     }
                   ]
                 ' "$PROGRESS_FILE"
                 ```

              4. Mark current QA phase as failed:
                 ```bash
                 yq -i '
                   (.. | select(.id == "qa" and .status == "in-progress")) |=
                   (.status = "failed" | .error = "QA failed - see artifacts/step-0-qa-report.md - fix-qa phase added")
                 ' "$PROGRESS_FILE"
                 ```

              5. The sprint loop will now execute:
                 - fix-qa → fixes the issues
                 - verify-qa → confirms fixes work

              ## Important
              - Focus on compilation and integration (no unit test suite yet)
              - Reference context/sprint-plan.md for acceptance criteria
              - QA failures MUST result in injected fix tasks, not just reports
            started-at: "2026-01-16T10:36:55Z"
            completed-at: "2026-01-16T10:37:39Z"
            elapsed: 00:00:44
        started-at: "2026-01-16T10:35:31Z"
      - id: step-1
        prompt: |
          Create file watcher with debounce for PROGRESS.yaml changes.

          File: compiler/src/status-server/watcher.ts

          Requirements:
          - Watch PROGRESS.yaml file using fs.watch()
          - Implement 100ms debounce to prevent excessive updates
          - Emit events on file changes
          - Handle file deletion/recreation gracefully
        status: completed
        phases:
          - id: implement
            status: completed
            prompt: |
              Execute the following task:

              Create file watcher with debounce for PROGRESS.yaml changes.

              File: compiler/src/status-server/watcher.ts

              Requirements:
              - Watch PROGRESS.yaml file using fs.watch()
              - Implement 100ms debounce to prevent excessive updates
              - Emit events on file changes
              - Handle file deletion/recreation gracefully


              ## Before Starting
              1. Read context/sprint-plan.md to understand:
                 - How this step fits into the overall sprint goal
                 - Architecture decisions that affect this step
                 - Success criteria for this specific step
                 - Dependencies on previous steps

              ## Implementation Guidelines
              - Follow existing patterns in the codebase
              - Keep code simple and focused on the task
              - Make atomic commits for logical units of work
              - If blocked or unclear, set status to needs-human

              ## Complete this task fully before marking as done.
            started-at: "2026-01-16T10:37:58Z"
            completed-at: "2026-01-16T10:37:58Z"
            elapsed: 00:00:00
          - id: qa
            status: completed
            prompt: |
              Quality Assurance verification for the m42-sprint plugin.

              ## Context
              Step: step-1
              Task: Create file watcher with debounce for PROGRESS.yaml changes.

              File: compiler/src/status-server/watcher.ts

              Requirements:
              - Watch PROGRESS.yaml file using fs.watch()
              - Implement 100ms debounce to prevent excessive updates
              - Emit events on file changes
              - Handle file deletion/recreation gracefully


              ## Step 1: Run QA Checks

              ### TypeScript (if compiler/ was modified)
              ```bash
              cd plugins/m42-sprint/compiler && npm run build
              ```
              - Build completes without errors
              - New code integrates with existing types

              ### Shell Scripts (if scripts/ was modified)
              ```bash
              bash -n plugins/m42-sprint/scripts/<script>.sh
              ```
              - Script syntax is valid

              ### Commands/Workflows (if modified)
              - YAML syntax valid (use yq to verify)
              - Template variables correct

              ### Integration
              - Matches architecture in context/sprint-plan.md
              - Follows existing codebase patterns
              - No breaking changes

              ### Smoke Test
              - Manually verify the implementation works

              ## Step 2: Write QA Report

              Write report to: artifacts/step-1-qa-report.md

              ```markdown
              # QA Report: step-1

              ## Checks Performed
              | Check | Result | Details |
              |-------|--------|---------|
              | TypeScript build | PASS/FAIL/SKIP | ... |
              | Script validation | PASS/FAIL/SKIP | ... |
              | Integration | PASS/FAIL | ... |
              | Smoke test | PASS/FAIL | ... |

              ## Issues Found
              1. [Issue description]
              2. [Issue description]

              ## Status: PASS / FAIL
              ```

              ## Step 3: Handle Outcome

              ### If ALL checks PASS:
              - Ensure QA report shows "Status: PASS"
              - Mark this phase as completed
              - Done!

              ### If ANY check FAILS:
              You MUST inject fix tasks into PROGRESS.yaml. Do NOT just report issues.

              1. Ensure QA report shows "Status: FAIL" with specific issues listed

              2. Determine the sprint directory (where PROGRESS.yaml lives):
                 ```bash
                 # The sprint directory is the parent of context/ and artifacts/
                 SPRINT_DIR=$(dirname "$(pwd)/artifacts" 2>/dev/null || echo ".")
                 # Or find it from PROGRESS.yaml location
                 PROGRESS_FILE=$(find .claude/sprints -name "PROGRESS.yaml" -newer .claude/sprints/*/SPRINT.yaml 2>/dev/null | head -1)
                 ```

              3. Insert fix + verify phases using yq:
                 ```bash
                 # Add fix-qa and verify-qa phases after the current qa phase
                 yq -i '
                   (.phases[] | select(.steps) | .steps[] | select(.status == "in-progress")).phases +=
                   [
                     {
                       "id": "fix-qa",
                       "status": "pending",
                       "prompt": "Fix the QA issues identified in artifacts/step-1-qa-report.md.\n\nInstructions:\n1. Read the QA report carefully\n2. Fix each identified issue\n3. Re-run the failed checks to confirm fixes\n4. Update artifacts/step-1-qa-report.md with fix status"
                     },
                     {
                       "id": "verify-qa",
                       "status": "pending",
                       "prompt": "Verify all QA issues from step-1 are resolved.\n\nRe-run ALL checks from the original QA:\n- TypeScript build (if applicable)\n- Script validation (if applicable)\n- Integration verification\n- Smoke test\n\nUpdate artifacts/step-1-qa-report.md with final PASS status.\nIf still failing, inject another fix-qa phase."
                     }
                   ]
                 ' "$PROGRESS_FILE"
                 ```

              4. Mark current QA phase as failed:
                 ```bash
                 yq -i '
                   (.. | select(.id == "qa" and .status == "in-progress")) |=
                   (.status = "failed" | .error = "QA failed - see artifacts/step-1-qa-report.md - fix-qa phase added")
                 ' "$PROGRESS_FILE"
                 ```

              5. The sprint loop will now execute:
                 - fix-qa → fixes the issues
                 - verify-qa → confirms fixes work

              ## Important
              - Focus on compilation and integration (no unit test suite yet)
              - Reference context/sprint-plan.md for acceptance criteria
              - QA failures MUST result in injected fix tasks, not just reports
            started-at: "2026-01-16T10:39:02Z"
            completed-at: "2026-01-16T10:39:02Z"
            elapsed: 00:00:00
        started-at: "2026-01-16T10:37:58Z"
      - id: step-2
        prompt: |
          Create data transformation functions.

          File: compiler/src/status-server/transforms.ts

          Requirements:
          - Convert CompiledProgress to StatusUpdate format
          - Generate log entries for status changes (started, completed, failed)
          - Calculate progress percentages
          - Format timestamps for display
        status: in-progress
        phases:
          - id: implement
            status: completed
            prompt: |
              Execute the following task:

              Create data transformation functions.

              File: compiler/src/status-server/transforms.ts

              Requirements:
              - Convert CompiledProgress to StatusUpdate format
              - Generate log entries for status changes (started, completed, failed)
              - Calculate progress percentages
              - Format timestamps for display


              ## Before Starting
              1. Read context/sprint-plan.md to understand:
                 - How this step fits into the overall sprint goal
                 - Architecture decisions that affect this step
                 - Success criteria for this specific step
                 - Dependencies on previous steps

              ## Implementation Guidelines
              - Follow existing patterns in the codebase
              - Keep code simple and focused on the task
              - Make atomic commits for logical units of work
              - If blocked or unclear, set status to needs-human

              ## Complete this task fully before marking as done.
            started-at: "2026-01-16T10:40:32Z"
            completed-at: "2026-01-16T10:42:05Z"
          - id: qa
            status: pending
            prompt: |
              Quality Assurance verification for the m42-sprint plugin.

              ## Context
              Step: step-2
              Task: Create data transformation functions.

              File: compiler/src/status-server/transforms.ts

              Requirements:
              - Convert CompiledProgress to StatusUpdate format
              - Generate log entries for status changes (started, completed, failed)
              - Calculate progress percentages
              - Format timestamps for display


              ## Step 1: Run QA Checks

              ### TypeScript (if compiler/ was modified)
              ```bash
              cd plugins/m42-sprint/compiler && npm run build
              ```
              - Build completes without errors
              - New code integrates with existing types

              ### Shell Scripts (if scripts/ was modified)
              ```bash
              bash -n plugins/m42-sprint/scripts/<script>.sh
              ```
              - Script syntax is valid

              ### Commands/Workflows (if modified)
              - YAML syntax valid (use yq to verify)
              - Template variables correct

              ### Integration
              - Matches architecture in context/sprint-plan.md
              - Follows existing codebase patterns
              - No breaking changes

              ### Smoke Test
              - Manually verify the implementation works

              ## Step 2: Write QA Report

              Write report to: artifacts/step-2-qa-report.md

              ```markdown
              # QA Report: step-2

              ## Checks Performed
              | Check | Result | Details |
              |-------|--------|---------|
              | TypeScript build | PASS/FAIL/SKIP | ... |
              | Script validation | PASS/FAIL/SKIP | ... |
              | Integration | PASS/FAIL | ... |
              | Smoke test | PASS/FAIL | ... |

              ## Issues Found
              1. [Issue description]
              2. [Issue description]

              ## Status: PASS / FAIL
              ```

              ## Step 3: Handle Outcome

              ### If ALL checks PASS:
              - Ensure QA report shows "Status: PASS"
              - Mark this phase as completed
              - Done!

              ### If ANY check FAILS:
              You MUST inject fix tasks into PROGRESS.yaml. Do NOT just report issues.

              1. Ensure QA report shows "Status: FAIL" with specific issues listed

              2. Determine the sprint directory (where PROGRESS.yaml lives):
                 ```bash
                 # The sprint directory is the parent of context/ and artifacts/
                 SPRINT_DIR=$(dirname "$(pwd)/artifacts" 2>/dev/null || echo ".")
                 # Or find it from PROGRESS.yaml location
                 PROGRESS_FILE=$(find .claude/sprints -name "PROGRESS.yaml" -newer .claude/sprints/*/SPRINT.yaml 2>/dev/null | head -1)
                 ```

              3. Insert fix + verify phases using yq:
                 ```bash
                 # Add fix-qa and verify-qa phases after the current qa phase
                 yq -i '
                   (.phases[] | select(.steps) | .steps[] | select(.status == "in-progress")).phases +=
                   [
                     {
                       "id": "fix-qa",
                       "status": "pending",
                       "prompt": "Fix the QA issues identified in artifacts/step-2-qa-report.md.\n\nInstructions:\n1. Read the QA report carefully\n2. Fix each identified issue\n3. Re-run the failed checks to confirm fixes\n4. Update artifacts/step-2-qa-report.md with fix status"
                     },
                     {
                       "id": "verify-qa",
                       "status": "pending",
                       "prompt": "Verify all QA issues from step-2 are resolved.\n\nRe-run ALL checks from the original QA:\n- TypeScript build (if applicable)\n- Script validation (if applicable)\n- Integration verification\n- Smoke test\n\nUpdate artifacts/step-2-qa-report.md with final PASS status.\nIf still failing, inject another fix-qa phase."
                     }
                   ]
                 ' "$PROGRESS_FILE"
                 ```

              4. Mark current QA phase as failed:
                 ```bash
                 yq -i '
                   (.. | select(.id == "qa" and .status == "in-progress")) |=
                   (.status = "failed" | .error = "QA failed - see artifacts/step-2-qa-report.md - fix-qa phase added")
                 ' "$PROGRESS_FILE"
                 ```

              5. The sprint loop will now execute:
                 - fix-qa → fixes the issues
                 - verify-qa → confirms fixes work

              ## Important
              - Focus on compilation and integration (no unit test suite yet)
              - Reference context/sprint-plan.md for acceptance criteria
              - QA failures MUST result in injected fix tasks, not just reports
        started-at: "2026-01-16T10:40:32Z"
      - id: step-3
        prompt: |
          Create HTML page with embedded CSS and JavaScript.

          File: compiler/src/status-server/page.ts

          Requirements:
          - Dark theme, monospace font
          - Header: sprint name, status badge, progress bar, iteration count
          - Left panel: hierarchical phase tree with status icons
          - Right top: current task (path, prompt, started time)
          - Right bottom: activity feed (log entries)
          - Client JS uses EventSource for SSE connection
          - All CSS/JS embedded as template literal (no external files)
        status: pending
        phases:
          - id: implement
            status: pending
            prompt: |
              Execute the following task:

              Create HTML page with embedded CSS and JavaScript.

              File: compiler/src/status-server/page.ts

              Requirements:
              - Dark theme, monospace font
              - Header: sprint name, status badge, progress bar, iteration count
              - Left panel: hierarchical phase tree with status icons
              - Right top: current task (path, prompt, started time)
              - Right bottom: activity feed (log entries)
              - Client JS uses EventSource for SSE connection
              - All CSS/JS embedded as template literal (no external files)


              ## Before Starting
              1. Read context/sprint-plan.md to understand:
                 - How this step fits into the overall sprint goal
                 - Architecture decisions that affect this step
                 - Success criteria for this specific step
                 - Dependencies on previous steps

              ## Implementation Guidelines
              - Follow existing patterns in the codebase
              - Keep code simple and focused on the task
              - Make atomic commits for logical units of work
              - If blocked or unclear, set status to needs-human

              ## Complete this task fully before marking as done.
          - id: qa
            status: pending
            prompt: |
              Quality Assurance verification for the m42-sprint plugin.

              ## Context
              Step: step-3
              Task: Create HTML page with embedded CSS and JavaScript.

              File: compiler/src/status-server/page.ts

              Requirements:
              - Dark theme, monospace font
              - Header: sprint name, status badge, progress bar, iteration count
              - Left panel: hierarchical phase tree with status icons
              - Right top: current task (path, prompt, started time)
              - Right bottom: activity feed (log entries)
              - Client JS uses EventSource for SSE connection
              - All CSS/JS embedded as template literal (no external files)


              ## Step 1: Run QA Checks

              ### TypeScript (if compiler/ was modified)
              ```bash
              cd plugins/m42-sprint/compiler && npm run build
              ```
              - Build completes without errors
              - New code integrates with existing types

              ### Shell Scripts (if scripts/ was modified)
              ```bash
              bash -n plugins/m42-sprint/scripts/<script>.sh
              ```
              - Script syntax is valid

              ### Commands/Workflows (if modified)
              - YAML syntax valid (use yq to verify)
              - Template variables correct

              ### Integration
              - Matches architecture in context/sprint-plan.md
              - Follows existing codebase patterns
              - No breaking changes

              ### Smoke Test
              - Manually verify the implementation works

              ## Step 2: Write QA Report

              Write report to: artifacts/step-3-qa-report.md

              ```markdown
              # QA Report: step-3

              ## Checks Performed
              | Check | Result | Details |
              |-------|--------|---------|
              | TypeScript build | PASS/FAIL/SKIP | ... |
              | Script validation | PASS/FAIL/SKIP | ... |
              | Integration | PASS/FAIL | ... |
              | Smoke test | PASS/FAIL | ... |

              ## Issues Found
              1. [Issue description]
              2. [Issue description]

              ## Status: PASS / FAIL
              ```

              ## Step 3: Handle Outcome

              ### If ALL checks PASS:
              - Ensure QA report shows "Status: PASS"
              - Mark this phase as completed
              - Done!

              ### If ANY check FAILS:
              You MUST inject fix tasks into PROGRESS.yaml. Do NOT just report issues.

              1. Ensure QA report shows "Status: FAIL" with specific issues listed

              2. Determine the sprint directory (where PROGRESS.yaml lives):
                 ```bash
                 # The sprint directory is the parent of context/ and artifacts/
                 SPRINT_DIR=$(dirname "$(pwd)/artifacts" 2>/dev/null || echo ".")
                 # Or find it from PROGRESS.yaml location
                 PROGRESS_FILE=$(find .claude/sprints -name "PROGRESS.yaml" -newer .claude/sprints/*/SPRINT.yaml 2>/dev/null | head -1)
                 ```

              3. Insert fix + verify phases using yq:
                 ```bash
                 # Add fix-qa and verify-qa phases after the current qa phase
                 yq -i '
                   (.phases[] | select(.steps) | .steps[] | select(.status == "in-progress")).phases +=
                   [
                     {
                       "id": "fix-qa",
                       "status": "pending",
                       "prompt": "Fix the QA issues identified in artifacts/step-3-qa-report.md.\n\nInstructions:\n1. Read the QA report carefully\n2. Fix each identified issue\n3. Re-run the failed checks to confirm fixes\n4. Update artifacts/step-3-qa-report.md with fix status"
                     },
                     {
                       "id": "verify-qa",
                       "status": "pending",
                       "prompt": "Verify all QA issues from step-3 are resolved.\n\nRe-run ALL checks from the original QA:\n- TypeScript build (if applicable)\n- Script validation (if applicable)\n- Integration verification\n- Smoke test\n\nUpdate artifacts/step-3-qa-report.md with final PASS status.\nIf still failing, inject another fix-qa phase."
                     }
                   ]
                 ' "$PROGRESS_FILE"
                 ```

              4. Mark current QA phase as failed:
                 ```bash
                 yq -i '
                   (.. | select(.id == "qa" and .status == "in-progress")) |=
                   (.status = "failed" | .error = "QA failed - see artifacts/step-3-qa-report.md - fix-qa phase added")
                 ' "$PROGRESS_FILE"
                 ```

              5. The sprint loop will now execute:
                 - fix-qa → fixes the issues
                 - verify-qa → confirms fixes work

              ## Important
              - Focus on compilation and integration (no unit test suite yet)
              - Reference context/sprint-plan.md for acceptance criteria
              - QA failures MUST result in injected fix tasks, not just reports
      - id: step-4
        prompt: |
          Create HTTP server with SSE endpoint.

          File: compiler/src/status-server/server.ts

          Requirements:
          - Use Node.js built-in http module
          - GET / - serve HTML page
          - GET /events - SSE endpoint with keep-alive
          - GET /api/status - JSON API (optional)
          - Integrate watcher and transforms
          - Handle client disconnections gracefully
        status: pending
        phases:
          - id: implement
            status: pending
            prompt: |
              Execute the following task:

              Create HTTP server with SSE endpoint.

              File: compiler/src/status-server/server.ts

              Requirements:
              - Use Node.js built-in http module
              - GET / - serve HTML page
              - GET /events - SSE endpoint with keep-alive
              - GET /api/status - JSON API (optional)
              - Integrate watcher and transforms
              - Handle client disconnections gracefully


              ## Before Starting
              1. Read context/sprint-plan.md to understand:
                 - How this step fits into the overall sprint goal
                 - Architecture decisions that affect this step
                 - Success criteria for this specific step
                 - Dependencies on previous steps

              ## Implementation Guidelines
              - Follow existing patterns in the codebase
              - Keep code simple and focused on the task
              - Make atomic commits for logical units of work
              - If blocked or unclear, set status to needs-human

              ## Complete this task fully before marking as done.
          - id: qa
            status: pending
            prompt: |
              Quality Assurance verification for the m42-sprint plugin.

              ## Context
              Step: step-4
              Task: Create HTTP server with SSE endpoint.

              File: compiler/src/status-server/server.ts

              Requirements:
              - Use Node.js built-in http module
              - GET / - serve HTML page
              - GET /events - SSE endpoint with keep-alive
              - GET /api/status - JSON API (optional)
              - Integrate watcher and transforms
              - Handle client disconnections gracefully


              ## Step 1: Run QA Checks

              ### TypeScript (if compiler/ was modified)
              ```bash
              cd plugins/m42-sprint/compiler && npm run build
              ```
              - Build completes without errors
              - New code integrates with existing types

              ### Shell Scripts (if scripts/ was modified)
              ```bash
              bash -n plugins/m42-sprint/scripts/<script>.sh
              ```
              - Script syntax is valid

              ### Commands/Workflows (if modified)
              - YAML syntax valid (use yq to verify)
              - Template variables correct

              ### Integration
              - Matches architecture in context/sprint-plan.md
              - Follows existing codebase patterns
              - No breaking changes

              ### Smoke Test
              - Manually verify the implementation works

              ## Step 2: Write QA Report

              Write report to: artifacts/step-4-qa-report.md

              ```markdown
              # QA Report: step-4

              ## Checks Performed
              | Check | Result | Details |
              |-------|--------|---------|
              | TypeScript build | PASS/FAIL/SKIP | ... |
              | Script validation | PASS/FAIL/SKIP | ... |
              | Integration | PASS/FAIL | ... |
              | Smoke test | PASS/FAIL | ... |

              ## Issues Found
              1. [Issue description]
              2. [Issue description]

              ## Status: PASS / FAIL
              ```

              ## Step 3: Handle Outcome

              ### If ALL checks PASS:
              - Ensure QA report shows "Status: PASS"
              - Mark this phase as completed
              - Done!

              ### If ANY check FAILS:
              You MUST inject fix tasks into PROGRESS.yaml. Do NOT just report issues.

              1. Ensure QA report shows "Status: FAIL" with specific issues listed

              2. Determine the sprint directory (where PROGRESS.yaml lives):
                 ```bash
                 # The sprint directory is the parent of context/ and artifacts/
                 SPRINT_DIR=$(dirname "$(pwd)/artifacts" 2>/dev/null || echo ".")
                 # Or find it from PROGRESS.yaml location
                 PROGRESS_FILE=$(find .claude/sprints -name "PROGRESS.yaml" -newer .claude/sprints/*/SPRINT.yaml 2>/dev/null | head -1)
                 ```

              3. Insert fix + verify phases using yq:
                 ```bash
                 # Add fix-qa and verify-qa phases after the current qa phase
                 yq -i '
                   (.phases[] | select(.steps) | .steps[] | select(.status == "in-progress")).phases +=
                   [
                     {
                       "id": "fix-qa",
                       "status": "pending",
                       "prompt": "Fix the QA issues identified in artifacts/step-4-qa-report.md.\n\nInstructions:\n1. Read the QA report carefully\n2. Fix each identified issue\n3. Re-run the failed checks to confirm fixes\n4. Update artifacts/step-4-qa-report.md with fix status"
                     },
                     {
                       "id": "verify-qa",
                       "status": "pending",
                       "prompt": "Verify all QA issues from step-4 are resolved.\n\nRe-run ALL checks from the original QA:\n- TypeScript build (if applicable)\n- Script validation (if applicable)\n- Integration verification\n- Smoke test\n\nUpdate artifacts/step-4-qa-report.md with final PASS status.\nIf still failing, inject another fix-qa phase."
                     }
                   ]
                 ' "$PROGRESS_FILE"
                 ```

              4. Mark current QA phase as failed:
                 ```bash
                 yq -i '
                   (.. | select(.id == "qa" and .status == "in-progress")) |=
                   (.status = "failed" | .error = "QA failed - see artifacts/step-4-qa-report.md - fix-qa phase added")
                 ' "$PROGRESS_FILE"
                 ```

              5. The sprint loop will now execute:
                 - fix-qa → fixes the issues
                 - verify-qa → confirms fixes work

              ## Important
              - Focus on compilation and integration (no unit test suite yet)
              - Reference context/sprint-plan.md for acceptance criteria
              - QA failures MUST result in injected fix tasks, not just reports
      - id: step-5
        prompt: |
          Create CLI entry point.

          File: compiler/src/status-server/index.ts

          Requirements:
          - Use commander for CLI parsing
          - Command: sprint-status-server <sprint-dir> [--port N] [--host HOST]
          - Default port: 3100
          - Default host: localhost
          - Write port to .sprint-status.port file for discovery
          - Show server URL on startup
        status: pending
        phases:
          - id: implement
            status: pending
            prompt: |
              Execute the following task:

              Create CLI entry point.

              File: compiler/src/status-server/index.ts

              Requirements:
              - Use commander for CLI parsing
              - Command: sprint-status-server <sprint-dir> [--port N] [--host HOST]
              - Default port: 3100
              - Default host: localhost
              - Write port to .sprint-status.port file for discovery
              - Show server URL on startup


              ## Before Starting
              1. Read context/sprint-plan.md to understand:
                 - How this step fits into the overall sprint goal
                 - Architecture decisions that affect this step
                 - Success criteria for this specific step
                 - Dependencies on previous steps

              ## Implementation Guidelines
              - Follow existing patterns in the codebase
              - Keep code simple and focused on the task
              - Make atomic commits for logical units of work
              - If blocked or unclear, set status to needs-human

              ## Complete this task fully before marking as done.
          - id: qa
            status: pending
            prompt: |
              Quality Assurance verification for the m42-sprint plugin.

              ## Context
              Step: step-5
              Task: Create CLI entry point.

              File: compiler/src/status-server/index.ts

              Requirements:
              - Use commander for CLI parsing
              - Command: sprint-status-server <sprint-dir> [--port N] [--host HOST]
              - Default port: 3100
              - Default host: localhost
              - Write port to .sprint-status.port file for discovery
              - Show server URL on startup


              ## Step 1: Run QA Checks

              ### TypeScript (if compiler/ was modified)
              ```bash
              cd plugins/m42-sprint/compiler && npm run build
              ```
              - Build completes without errors
              - New code integrates with existing types

              ### Shell Scripts (if scripts/ was modified)
              ```bash
              bash -n plugins/m42-sprint/scripts/<script>.sh
              ```
              - Script syntax is valid

              ### Commands/Workflows (if modified)
              - YAML syntax valid (use yq to verify)
              - Template variables correct

              ### Integration
              - Matches architecture in context/sprint-plan.md
              - Follows existing codebase patterns
              - No breaking changes

              ### Smoke Test
              - Manually verify the implementation works

              ## Step 2: Write QA Report

              Write report to: artifacts/step-5-qa-report.md

              ```markdown
              # QA Report: step-5

              ## Checks Performed
              | Check | Result | Details |
              |-------|--------|---------|
              | TypeScript build | PASS/FAIL/SKIP | ... |
              | Script validation | PASS/FAIL/SKIP | ... |
              | Integration | PASS/FAIL | ... |
              | Smoke test | PASS/FAIL | ... |

              ## Issues Found
              1. [Issue description]
              2. [Issue description]

              ## Status: PASS / FAIL
              ```

              ## Step 3: Handle Outcome

              ### If ALL checks PASS:
              - Ensure QA report shows "Status: PASS"
              - Mark this phase as completed
              - Done!

              ### If ANY check FAILS:
              You MUST inject fix tasks into PROGRESS.yaml. Do NOT just report issues.

              1. Ensure QA report shows "Status: FAIL" with specific issues listed

              2. Determine the sprint directory (where PROGRESS.yaml lives):
                 ```bash
                 # The sprint directory is the parent of context/ and artifacts/
                 SPRINT_DIR=$(dirname "$(pwd)/artifacts" 2>/dev/null || echo ".")
                 # Or find it from PROGRESS.yaml location
                 PROGRESS_FILE=$(find .claude/sprints -name "PROGRESS.yaml" -newer .claude/sprints/*/SPRINT.yaml 2>/dev/null | head -1)
                 ```

              3. Insert fix + verify phases using yq:
                 ```bash
                 # Add fix-qa and verify-qa phases after the current qa phase
                 yq -i '
                   (.phases[] | select(.steps) | .steps[] | select(.status == "in-progress")).phases +=
                   [
                     {
                       "id": "fix-qa",
                       "status": "pending",
                       "prompt": "Fix the QA issues identified in artifacts/step-5-qa-report.md.\n\nInstructions:\n1. Read the QA report carefully\n2. Fix each identified issue\n3. Re-run the failed checks to confirm fixes\n4. Update artifacts/step-5-qa-report.md with fix status"
                     },
                     {
                       "id": "verify-qa",
                       "status": "pending",
                       "prompt": "Verify all QA issues from step-5 are resolved.\n\nRe-run ALL checks from the original QA:\n- TypeScript build (if applicable)\n- Script validation (if applicable)\n- Integration verification\n- Smoke test\n\nUpdate artifacts/step-5-qa-report.md with final PASS status.\nIf still failing, inject another fix-qa phase."
                     }
                   ]
                 ' "$PROGRESS_FILE"
                 ```

              4. Mark current QA phase as failed:
                 ```bash
                 yq -i '
                   (.. | select(.id == "qa" and .status == "in-progress")) |=
                   (.status = "failed" | .error = "QA failed - see artifacts/step-5-qa-report.md - fix-qa phase added")
                 ' "$PROGRESS_FILE"
                 ```

              5. The sprint loop will now execute:
                 - fix-qa → fixes the issues
                 - verify-qa → confirms fixes work

              ## Important
              - Focus on compilation and integration (no unit test suite yet)
              - Reference context/sprint-plan.md for acceptance criteria
              - QA failures MUST result in injected fix tasks, not just reports
      - id: step-6
        prompt: |
          Update package.json with new bin entry.

          File: compiler/package.json

          Requirements:
          - Add "sprint-status-server": "./dist/status-server/index.js" to bin section
          - Ensure it's alongside existing "sprint-compile" entry
        status: pending
        phases:
          - id: implement
            status: pending
            prompt: |
              Execute the following task:

              Update package.json with new bin entry.

              File: compiler/package.json

              Requirements:
              - Add "sprint-status-server": "./dist/status-server/index.js" to bin section
              - Ensure it's alongside existing "sprint-compile" entry


              ## Before Starting
              1. Read context/sprint-plan.md to understand:
                 - How this step fits into the overall sprint goal
                 - Architecture decisions that affect this step
                 - Success criteria for this specific step
                 - Dependencies on previous steps

              ## Implementation Guidelines
              - Follow existing patterns in the codebase
              - Keep code simple and focused on the task
              - Make atomic commits for logical units of work
              - If blocked or unclear, set status to needs-human

              ## Complete this task fully before marking as done.
          - id: qa
            status: pending
            prompt: |
              Quality Assurance verification for the m42-sprint plugin.

              ## Context
              Step: step-6
              Task: Update package.json with new bin entry.

              File: compiler/package.json

              Requirements:
              - Add "sprint-status-server": "./dist/status-server/index.js" to bin section
              - Ensure it's alongside existing "sprint-compile" entry


              ## Step 1: Run QA Checks

              ### TypeScript (if compiler/ was modified)
              ```bash
              cd plugins/m42-sprint/compiler && npm run build
              ```
              - Build completes without errors
              - New code integrates with existing types

              ### Shell Scripts (if scripts/ was modified)
              ```bash
              bash -n plugins/m42-sprint/scripts/<script>.sh
              ```
              - Script syntax is valid

              ### Commands/Workflows (if modified)
              - YAML syntax valid (use yq to verify)
              - Template variables correct

              ### Integration
              - Matches architecture in context/sprint-plan.md
              - Follows existing codebase patterns
              - No breaking changes

              ### Smoke Test
              - Manually verify the implementation works

              ## Step 2: Write QA Report

              Write report to: artifacts/step-6-qa-report.md

              ```markdown
              # QA Report: step-6

              ## Checks Performed
              | Check | Result | Details |
              |-------|--------|---------|
              | TypeScript build | PASS/FAIL/SKIP | ... |
              | Script validation | PASS/FAIL/SKIP | ... |
              | Integration | PASS/FAIL | ... |
              | Smoke test | PASS/FAIL | ... |

              ## Issues Found
              1. [Issue description]
              2. [Issue description]

              ## Status: PASS / FAIL
              ```

              ## Step 3: Handle Outcome

              ### If ALL checks PASS:
              - Ensure QA report shows "Status: PASS"
              - Mark this phase as completed
              - Done!

              ### If ANY check FAILS:
              You MUST inject fix tasks into PROGRESS.yaml. Do NOT just report issues.

              1. Ensure QA report shows "Status: FAIL" with specific issues listed

              2. Determine the sprint directory (where PROGRESS.yaml lives):
                 ```bash
                 # The sprint directory is the parent of context/ and artifacts/
                 SPRINT_DIR=$(dirname "$(pwd)/artifacts" 2>/dev/null || echo ".")
                 # Or find it from PROGRESS.yaml location
                 PROGRESS_FILE=$(find .claude/sprints -name "PROGRESS.yaml" -newer .claude/sprints/*/SPRINT.yaml 2>/dev/null | head -1)
                 ```

              3. Insert fix + verify phases using yq:
                 ```bash
                 # Add fix-qa and verify-qa phases after the current qa phase
                 yq -i '
                   (.phases[] | select(.steps) | .steps[] | select(.status == "in-progress")).phases +=
                   [
                     {
                       "id": "fix-qa",
                       "status": "pending",
                       "prompt": "Fix the QA issues identified in artifacts/step-6-qa-report.md.\n\nInstructions:\n1. Read the QA report carefully\n2. Fix each identified issue\n3. Re-run the failed checks to confirm fixes\n4. Update artifacts/step-6-qa-report.md with fix status"
                     },
                     {
                       "id": "verify-qa",
                       "status": "pending",
                       "prompt": "Verify all QA issues from step-6 are resolved.\n\nRe-run ALL checks from the original QA:\n- TypeScript build (if applicable)\n- Script validation (if applicable)\n- Integration verification\n- Smoke test\n\nUpdate artifacts/step-6-qa-report.md with final PASS status.\nIf still failing, inject another fix-qa phase."
                     }
                   ]
                 ' "$PROGRESS_FILE"
                 ```

              4. Mark current QA phase as failed:
                 ```bash
                 yq -i '
                   (.. | select(.id == "qa" and .status == "in-progress")) |=
                   (.status = "failed" | .error = "QA failed - see artifacts/step-6-qa-report.md - fix-qa phase added")
                 ' "$PROGRESS_FILE"
                 ```

              5. The sprint loop will now execute:
                 - fix-qa → fixes the issues
                 - verify-qa → confirms fixes work

              ## Important
              - Focus on compilation and integration (no unit test suite yet)
              - Reference context/sprint-plan.md for acceptance criteria
              - QA failures MUST result in injected fix tasks, not just reports
      - id: step-7
        prompt: |
          Add iteration fields to SprintStats interface.

          File: compiler/src/types.ts

          Requirements:
          - Add 'current-iteration'?: number field
          - Add 'max-iterations'?: number field
          - Update SprintStats interface in existing types
        status: pending
        phases:
          - id: implement
            status: pending
            prompt: |
              Execute the following task:

              Add iteration fields to SprintStats interface.

              File: compiler/src/types.ts

              Requirements:
              - Add 'current-iteration'?: number field
              - Add 'max-iterations'?: number field
              - Update SprintStats interface in existing types


              ## Before Starting
              1. Read context/sprint-plan.md to understand:
                 - How this step fits into the overall sprint goal
                 - Architecture decisions that affect this step
                 - Success criteria for this specific step
                 - Dependencies on previous steps

              ## Implementation Guidelines
              - Follow existing patterns in the codebase
              - Keep code simple and focused on the task
              - Make atomic commits for logical units of work
              - If blocked or unclear, set status to needs-human

              ## Complete this task fully before marking as done.
          - id: qa
            status: pending
            prompt: |
              Quality Assurance verification for the m42-sprint plugin.

              ## Context
              Step: step-7
              Task: Add iteration fields to SprintStats interface.

              File: compiler/src/types.ts

              Requirements:
              - Add 'current-iteration'?: number field
              - Add 'max-iterations'?: number field
              - Update SprintStats interface in existing types


              ## Step 1: Run QA Checks

              ### TypeScript (if compiler/ was modified)
              ```bash
              cd plugins/m42-sprint/compiler && npm run build
              ```
              - Build completes without errors
              - New code integrates with existing types

              ### Shell Scripts (if scripts/ was modified)
              ```bash
              bash -n plugins/m42-sprint/scripts/<script>.sh
              ```
              - Script syntax is valid

              ### Commands/Workflows (if modified)
              - YAML syntax valid (use yq to verify)
              - Template variables correct

              ### Integration
              - Matches architecture in context/sprint-plan.md
              - Follows existing codebase patterns
              - No breaking changes

              ### Smoke Test
              - Manually verify the implementation works

              ## Step 2: Write QA Report

              Write report to: artifacts/step-7-qa-report.md

              ```markdown
              # QA Report: step-7

              ## Checks Performed
              | Check | Result | Details |
              |-------|--------|---------|
              | TypeScript build | PASS/FAIL/SKIP | ... |
              | Script validation | PASS/FAIL/SKIP | ... |
              | Integration | PASS/FAIL | ... |
              | Smoke test | PASS/FAIL | ... |

              ## Issues Found
              1. [Issue description]
              2. [Issue description]

              ## Status: PASS / FAIL
              ```

              ## Step 3: Handle Outcome

              ### If ALL checks PASS:
              - Ensure QA report shows "Status: PASS"
              - Mark this phase as completed
              - Done!

              ### If ANY check FAILS:
              You MUST inject fix tasks into PROGRESS.yaml. Do NOT just report issues.

              1. Ensure QA report shows "Status: FAIL" with specific issues listed

              2. Determine the sprint directory (where PROGRESS.yaml lives):
                 ```bash
                 # The sprint directory is the parent of context/ and artifacts/
                 SPRINT_DIR=$(dirname "$(pwd)/artifacts" 2>/dev/null || echo ".")
                 # Or find it from PROGRESS.yaml location
                 PROGRESS_FILE=$(find .claude/sprints -name "PROGRESS.yaml" -newer .claude/sprints/*/SPRINT.yaml 2>/dev/null | head -1)
                 ```

              3. Insert fix + verify phases using yq:
                 ```bash
                 # Add fix-qa and verify-qa phases after the current qa phase
                 yq -i '
                   (.phases[] | select(.steps) | .steps[] | select(.status == "in-progress")).phases +=
                   [
                     {
                       "id": "fix-qa",
                       "status": "pending",
                       "prompt": "Fix the QA issues identified in artifacts/step-7-qa-report.md.\n\nInstructions:\n1. Read the QA report carefully\n2. Fix each identified issue\n3. Re-run the failed checks to confirm fixes\n4. Update artifacts/step-7-qa-report.md with fix status"
                     },
                     {
                       "id": "verify-qa",
                       "status": "pending",
                       "prompt": "Verify all QA issues from step-7 are resolved.\n\nRe-run ALL checks from the original QA:\n- TypeScript build (if applicable)\n- Script validation (if applicable)\n- Integration verification\n- Smoke test\n\nUpdate artifacts/step-7-qa-report.md with final PASS status.\nIf still failing, inject another fix-qa phase."
                     }
                   ]
                 ' "$PROGRESS_FILE"
                 ```

              4. Mark current QA phase as failed:
                 ```bash
                 yq -i '
                   (.. | select(.id == "qa" and .status == "in-progress")) |=
                   (.status = "failed" | .error = "QA failed - see artifacts/step-7-qa-report.md - fix-qa phase added")
                 ' "$PROGRESS_FILE"
                 ```

              5. The sprint loop will now execute:
                 - fix-qa → fixes the issues
                 - verify-qa → confirms fixes work

              ## Important
              - Focus on compilation and integration (no unit test suite yet)
              - Reference context/sprint-plan.md for acceptance criteria
              - QA failures MUST result in injected fix tasks, not just reports
      - id: step-8
        prompt: |
          Update sprint loop to write iteration to PROGRESS.yaml.

          File: scripts/sprint-loop.sh (around line 249)

          Requirements:
          - Write current iteration using yq: .stats."current-iteration" = $i
          - Write max iterations using yq: .stats."max-iterations" = $MAX_ITERATIONS
          - Place updates after PROGRESS.yaml is created/updated
        status: pending
        phases:
          - id: implement
            status: pending
            prompt: |
              Execute the following task:

              Update sprint loop to write iteration to PROGRESS.yaml.

              File: scripts/sprint-loop.sh (around line 249)

              Requirements:
              - Write current iteration using yq: .stats."current-iteration" = $i
              - Write max iterations using yq: .stats."max-iterations" = $MAX_ITERATIONS
              - Place updates after PROGRESS.yaml is created/updated


              ## Before Starting
              1. Read context/sprint-plan.md to understand:
                 - How this step fits into the overall sprint goal
                 - Architecture decisions that affect this step
                 - Success criteria for this specific step
                 - Dependencies on previous steps

              ## Implementation Guidelines
              - Follow existing patterns in the codebase
              - Keep code simple and focused on the task
              - Make atomic commits for logical units of work
              - If blocked or unclear, set status to needs-human

              ## Complete this task fully before marking as done.
          - id: qa
            status: pending
            prompt: |
              Quality Assurance verification for the m42-sprint plugin.

              ## Context
              Step: step-8
              Task: Update sprint loop to write iteration to PROGRESS.yaml.

              File: scripts/sprint-loop.sh (around line 249)

              Requirements:
              - Write current iteration using yq: .stats."current-iteration" = $i
              - Write max iterations using yq: .stats."max-iterations" = $MAX_ITERATIONS
              - Place updates after PROGRESS.yaml is created/updated


              ## Step 1: Run QA Checks

              ### TypeScript (if compiler/ was modified)
              ```bash
              cd plugins/m42-sprint/compiler && npm run build
              ```
              - Build completes without errors
              - New code integrates with existing types

              ### Shell Scripts (if scripts/ was modified)
              ```bash
              bash -n plugins/m42-sprint/scripts/<script>.sh
              ```
              - Script syntax is valid

              ### Commands/Workflows (if modified)
              - YAML syntax valid (use yq to verify)
              - Template variables correct

              ### Integration
              - Matches architecture in context/sprint-plan.md
              - Follows existing codebase patterns
              - No breaking changes

              ### Smoke Test
              - Manually verify the implementation works

              ## Step 2: Write QA Report

              Write report to: artifacts/step-8-qa-report.md

              ```markdown
              # QA Report: step-8

              ## Checks Performed
              | Check | Result | Details |
              |-------|--------|---------|
              | TypeScript build | PASS/FAIL/SKIP | ... |
              | Script validation | PASS/FAIL/SKIP | ... |
              | Integration | PASS/FAIL | ... |
              | Smoke test | PASS/FAIL | ... |

              ## Issues Found
              1. [Issue description]
              2. [Issue description]

              ## Status: PASS / FAIL
              ```

              ## Step 3: Handle Outcome

              ### If ALL checks PASS:
              - Ensure QA report shows "Status: PASS"
              - Mark this phase as completed
              - Done!

              ### If ANY check FAILS:
              You MUST inject fix tasks into PROGRESS.yaml. Do NOT just report issues.

              1. Ensure QA report shows "Status: FAIL" with specific issues listed

              2. Determine the sprint directory (where PROGRESS.yaml lives):
                 ```bash
                 # The sprint directory is the parent of context/ and artifacts/
                 SPRINT_DIR=$(dirname "$(pwd)/artifacts" 2>/dev/null || echo ".")
                 # Or find it from PROGRESS.yaml location
                 PROGRESS_FILE=$(find .claude/sprints -name "PROGRESS.yaml" -newer .claude/sprints/*/SPRINT.yaml 2>/dev/null | head -1)
                 ```

              3. Insert fix + verify phases using yq:
                 ```bash
                 # Add fix-qa and verify-qa phases after the current qa phase
                 yq -i '
                   (.phases[] | select(.steps) | .steps[] | select(.status == "in-progress")).phases +=
                   [
                     {
                       "id": "fix-qa",
                       "status": "pending",
                       "prompt": "Fix the QA issues identified in artifacts/step-8-qa-report.md.\n\nInstructions:\n1. Read the QA report carefully\n2. Fix each identified issue\n3. Re-run the failed checks to confirm fixes\n4. Update artifacts/step-8-qa-report.md with fix status"
                     },
                     {
                       "id": "verify-qa",
                       "status": "pending",
                       "prompt": "Verify all QA issues from step-8 are resolved.\n\nRe-run ALL checks from the original QA:\n- TypeScript build (if applicable)\n- Script validation (if applicable)\n- Integration verification\n- Smoke test\n\nUpdate artifacts/step-8-qa-report.md with final PASS status.\nIf still failing, inject another fix-qa phase."
                     }
                   ]
                 ' "$PROGRESS_FILE"
                 ```

              4. Mark current QA phase as failed:
                 ```bash
                 yq -i '
                   (.. | select(.id == "qa" and .status == "in-progress")) |=
                   (.status = "failed" | .error = "QA failed - see artifacts/step-8-qa-report.md - fix-qa phase added")
                 ' "$PROGRESS_FILE"
                 ```

              5. The sprint loop will now execute:
                 - fix-qa → fixes the issues
                 - verify-qa → confirms fixes work

              ## Important
              - Focus on compilation and integration (no unit test suite yet)
              - Reference context/sprint-plan.md for acceptance criteria
              - QA failures MUST result in injected fix tasks, not just reports
      - id: step-9
        prompt: |
          Update run-sprint command to start status server.

          File: commands/run-sprint.md

          Requirements:
          - Launch sprint-status-server after starting sprint loop
          - Read port from .sprint-status.port file
          - Display "Live Status: http://localhost:{port}" message
          - Handle case where status server fails to start
        status: pending
        phases:
          - id: implement
            status: pending
            prompt: |
              Execute the following task:

              Update run-sprint command to start status server.

              File: commands/run-sprint.md

              Requirements:
              - Launch sprint-status-server after starting sprint loop
              - Read port from .sprint-status.port file
              - Display "Live Status: http://localhost:{port}" message
              - Handle case where status server fails to start


              ## Before Starting
              1. Read context/sprint-plan.md to understand:
                 - How this step fits into the overall sprint goal
                 - Architecture decisions that affect this step
                 - Success criteria for this specific step
                 - Dependencies on previous steps

              ## Implementation Guidelines
              - Follow existing patterns in the codebase
              - Keep code simple and focused on the task
              - Make atomic commits for logical units of work
              - If blocked or unclear, set status to needs-human

              ## Complete this task fully before marking as done.
          - id: qa
            status: pending
            prompt: |
              Quality Assurance verification for the m42-sprint plugin.

              ## Context
              Step: step-9
              Task: Update run-sprint command to start status server.

              File: commands/run-sprint.md

              Requirements:
              - Launch sprint-status-server after starting sprint loop
              - Read port from .sprint-status.port file
              - Display "Live Status: http://localhost:{port}" message
              - Handle case where status server fails to start


              ## Step 1: Run QA Checks

              ### TypeScript (if compiler/ was modified)
              ```bash
              cd plugins/m42-sprint/compiler && npm run build
              ```
              - Build completes without errors
              - New code integrates with existing types

              ### Shell Scripts (if scripts/ was modified)
              ```bash
              bash -n plugins/m42-sprint/scripts/<script>.sh
              ```
              - Script syntax is valid

              ### Commands/Workflows (if modified)
              - YAML syntax valid (use yq to verify)
              - Template variables correct

              ### Integration
              - Matches architecture in context/sprint-plan.md
              - Follows existing codebase patterns
              - No breaking changes

              ### Smoke Test
              - Manually verify the implementation works

              ## Step 2: Write QA Report

              Write report to: artifacts/step-9-qa-report.md

              ```markdown
              # QA Report: step-9

              ## Checks Performed
              | Check | Result | Details |
              |-------|--------|---------|
              | TypeScript build | PASS/FAIL/SKIP | ... |
              | Script validation | PASS/FAIL/SKIP | ... |
              | Integration | PASS/FAIL | ... |
              | Smoke test | PASS/FAIL | ... |

              ## Issues Found
              1. [Issue description]
              2. [Issue description]

              ## Status: PASS / FAIL
              ```

              ## Step 3: Handle Outcome

              ### If ALL checks PASS:
              - Ensure QA report shows "Status: PASS"
              - Mark this phase as completed
              - Done!

              ### If ANY check FAILS:
              You MUST inject fix tasks into PROGRESS.yaml. Do NOT just report issues.

              1. Ensure QA report shows "Status: FAIL" with specific issues listed

              2. Determine the sprint directory (where PROGRESS.yaml lives):
                 ```bash
                 # The sprint directory is the parent of context/ and artifacts/
                 SPRINT_DIR=$(dirname "$(pwd)/artifacts" 2>/dev/null || echo ".")
                 # Or find it from PROGRESS.yaml location
                 PROGRESS_FILE=$(find .claude/sprints -name "PROGRESS.yaml" -newer .claude/sprints/*/SPRINT.yaml 2>/dev/null | head -1)
                 ```

              3. Insert fix + verify phases using yq:
                 ```bash
                 # Add fix-qa and verify-qa phases after the current qa phase
                 yq -i '
                   (.phases[] | select(.steps) | .steps[] | select(.status == "in-progress")).phases +=
                   [
                     {
                       "id": "fix-qa",
                       "status": "pending",
                       "prompt": "Fix the QA issues identified in artifacts/step-9-qa-report.md.\n\nInstructions:\n1. Read the QA report carefully\n2. Fix each identified issue\n3. Re-run the failed checks to confirm fixes\n4. Update artifacts/step-9-qa-report.md with fix status"
                     },
                     {
                       "id": "verify-qa",
                       "status": "pending",
                       "prompt": "Verify all QA issues from step-9 are resolved.\n\nRe-run ALL checks from the original QA:\n- TypeScript build (if applicable)\n- Script validation (if applicable)\n- Integration verification\n- Smoke test\n\nUpdate artifacts/step-9-qa-report.md with final PASS status.\nIf still failing, inject another fix-qa phase."
                     }
                   ]
                 ' "$PROGRESS_FILE"
                 ```

              4. Mark current QA phase as failed:
                 ```bash
                 yq -i '
                   (.. | select(.id == "qa" and .status == "in-progress")) |=
                   (.status = "failed" | .error = "QA failed - see artifacts/step-9-qa-report.md - fix-qa phase added")
                 ' "$PROGRESS_FILE"
                 ```

              5. The sprint loop will now execute:
                 - fix-qa → fixes the issues
                 - verify-qa → confirms fixes work

              ## Important
              - Focus on compilation and integration (no unit test suite yet)
              - Reference context/sprint-plan.md for acceptance criteria
              - QA failures MUST result in injected fix tasks, not just reports
      - id: step-10
        prompt: |
          Create new command for standalone status server.

          File: commands/sprint-watch.md

          Requirements:
          - Document sprint-watch command
          - Usage: /sprint-watch [sprint-dir]
          - Start status server for existing sprint
          - Show URL and usage instructions
        status: pending
        phases:
          - id: implement
            status: pending
            prompt: |
              Execute the following task:

              Create new command for standalone status server.

              File: commands/sprint-watch.md

              Requirements:
              - Document sprint-watch command
              - Usage: /sprint-watch [sprint-dir]
              - Start status server for existing sprint
              - Show URL and usage instructions


              ## Before Starting
              1. Read context/sprint-plan.md to understand:
                 - How this step fits into the overall sprint goal
                 - Architecture decisions that affect this step
                 - Success criteria for this specific step
                 - Dependencies on previous steps

              ## Implementation Guidelines
              - Follow existing patterns in the codebase
              - Keep code simple and focused on the task
              - Make atomic commits for logical units of work
              - If blocked or unclear, set status to needs-human

              ## Complete this task fully before marking as done.
          - id: qa
            status: pending
            prompt: |
              Quality Assurance verification for the m42-sprint plugin.

              ## Context
              Step: step-10
              Task: Create new command for standalone status server.

              File: commands/sprint-watch.md

              Requirements:
              - Document sprint-watch command
              - Usage: /sprint-watch [sprint-dir]
              - Start status server for existing sprint
              - Show URL and usage instructions


              ## Step 1: Run QA Checks

              ### TypeScript (if compiler/ was modified)
              ```bash
              cd plugins/m42-sprint/compiler && npm run build
              ```
              - Build completes without errors
              - New code integrates with existing types

              ### Shell Scripts (if scripts/ was modified)
              ```bash
              bash -n plugins/m42-sprint/scripts/<script>.sh
              ```
              - Script syntax is valid

              ### Commands/Workflows (if modified)
              - YAML syntax valid (use yq to verify)
              - Template variables correct

              ### Integration
              - Matches architecture in context/sprint-plan.md
              - Follows existing codebase patterns
              - No breaking changes

              ### Smoke Test
              - Manually verify the implementation works

              ## Step 2: Write QA Report

              Write report to: artifacts/step-10-qa-report.md

              ```markdown
              # QA Report: step-10

              ## Checks Performed
              | Check | Result | Details |
              |-------|--------|---------|
              | TypeScript build | PASS/FAIL/SKIP | ... |
              | Script validation | PASS/FAIL/SKIP | ... |
              | Integration | PASS/FAIL | ... |
              | Smoke test | PASS/FAIL | ... |

              ## Issues Found
              1. [Issue description]
              2. [Issue description]

              ## Status: PASS / FAIL
              ```

              ## Step 3: Handle Outcome

              ### If ALL checks PASS:
              - Ensure QA report shows "Status: PASS"
              - Mark this phase as completed
              - Done!

              ### If ANY check FAILS:
              You MUST inject fix tasks into PROGRESS.yaml. Do NOT just report issues.

              1. Ensure QA report shows "Status: FAIL" with specific issues listed

              2. Determine the sprint directory (where PROGRESS.yaml lives):
                 ```bash
                 # The sprint directory is the parent of context/ and artifacts/
                 SPRINT_DIR=$(dirname "$(pwd)/artifacts" 2>/dev/null || echo ".")
                 # Or find it from PROGRESS.yaml location
                 PROGRESS_FILE=$(find .claude/sprints -name "PROGRESS.yaml" -newer .claude/sprints/*/SPRINT.yaml 2>/dev/null | head -1)
                 ```

              3. Insert fix + verify phases using yq:
                 ```bash
                 # Add fix-qa and verify-qa phases after the current qa phase
                 yq -i '
                   (.phases[] | select(.steps) | .steps[] | select(.status == "in-progress")).phases +=
                   [
                     {
                       "id": "fix-qa",
                       "status": "pending",
                       "prompt": "Fix the QA issues identified in artifacts/step-10-qa-report.md.\n\nInstructions:\n1. Read the QA report carefully\n2. Fix each identified issue\n3. Re-run the failed checks to confirm fixes\n4. Update artifacts/step-10-qa-report.md with fix status"
                     },
                     {
                       "id": "verify-qa",
                       "status": "pending",
                       "prompt": "Verify all QA issues from step-10 are resolved.\n\nRe-run ALL checks from the original QA:\n- TypeScript build (if applicable)\n- Script validation (if applicable)\n- Integration verification\n- Smoke test\n\nUpdate artifacts/step-10-qa-report.md with final PASS status.\nIf still failing, inject another fix-qa phase."
                     }
                   ]
                 ' "$PROGRESS_FILE"
                 ```

              4. Mark current QA phase as failed:
                 ```bash
                 yq -i '
                   (.. | select(.id == "qa" and .status == "in-progress")) |=
                   (.status = "failed" | .error = "QA failed - see artifacts/step-10-qa-report.md - fix-qa phase added")
                 ' "$PROGRESS_FILE"
                 ```

              5. The sprint loop will now execute:
                 - fix-qa → fixes the issues
                 - verify-qa → confirms fixes work

              ## Important
              - Focus on compilation and integration (no unit test suite yet)
              - Reference context/sprint-plan.md for acceptance criteria
              - QA failures MUST result in injected fix tasks, not just reports
      - id: step-11
        prompt: |
          Build and verify the implementation.

          Requirements:
          - Run: cd plugins/m42-sprint/compiler && npm run build
          - Verify: node dist/status-server/index.js --help
          - Test manual workflow: create test sprint, start server, edit PROGRESS.yaml
          - Test integration: run actual sprint and verify live updates
          - Fix any build errors or runtime issues
        status: pending
        phases:
          - id: implement
            status: pending
            prompt: |
              Execute the following task:

              Build and verify the implementation.

              Requirements:
              - Run: cd plugins/m42-sprint/compiler && npm run build
              - Verify: node dist/status-server/index.js --help
              - Test manual workflow: create test sprint, start server, edit PROGRESS.yaml
              - Test integration: run actual sprint and verify live updates
              - Fix any build errors or runtime issues


              ## Before Starting
              1. Read context/sprint-plan.md to understand:
                 - How this step fits into the overall sprint goal
                 - Architecture decisions that affect this step
                 - Success criteria for this specific step
                 - Dependencies on previous steps

              ## Implementation Guidelines
              - Follow existing patterns in the codebase
              - Keep code simple and focused on the task
              - Make atomic commits for logical units of work
              - If blocked or unclear, set status to needs-human

              ## Complete this task fully before marking as done.
          - id: qa
            status: pending
            prompt: |
              Quality Assurance verification for the m42-sprint plugin.

              ## Context
              Step: step-11
              Task: Build and verify the implementation.

              Requirements:
              - Run: cd plugins/m42-sprint/compiler && npm run build
              - Verify: node dist/status-server/index.js --help
              - Test manual workflow: create test sprint, start server, edit PROGRESS.yaml
              - Test integration: run actual sprint and verify live updates
              - Fix any build errors or runtime issues


              ## Step 1: Run QA Checks

              ### TypeScript (if compiler/ was modified)
              ```bash
              cd plugins/m42-sprint/compiler && npm run build
              ```
              - Build completes without errors
              - New code integrates with existing types

              ### Shell Scripts (if scripts/ was modified)
              ```bash
              bash -n plugins/m42-sprint/scripts/<script>.sh
              ```
              - Script syntax is valid

              ### Commands/Workflows (if modified)
              - YAML syntax valid (use yq to verify)
              - Template variables correct

              ### Integration
              - Matches architecture in context/sprint-plan.md
              - Follows existing codebase patterns
              - No breaking changes

              ### Smoke Test
              - Manually verify the implementation works

              ## Step 2: Write QA Report

              Write report to: artifacts/step-11-qa-report.md

              ```markdown
              # QA Report: step-11

              ## Checks Performed
              | Check | Result | Details |
              |-------|--------|---------|
              | TypeScript build | PASS/FAIL/SKIP | ... |
              | Script validation | PASS/FAIL/SKIP | ... |
              | Integration | PASS/FAIL | ... |
              | Smoke test | PASS/FAIL | ... |

              ## Issues Found
              1. [Issue description]
              2. [Issue description]

              ## Status: PASS / FAIL
              ```

              ## Step 3: Handle Outcome

              ### If ALL checks PASS:
              - Ensure QA report shows "Status: PASS"
              - Mark this phase as completed
              - Done!

              ### If ANY check FAILS:
              You MUST inject fix tasks into PROGRESS.yaml. Do NOT just report issues.

              1. Ensure QA report shows "Status: FAIL" with specific issues listed

              2. Determine the sprint directory (where PROGRESS.yaml lives):
                 ```bash
                 # The sprint directory is the parent of context/ and artifacts/
                 SPRINT_DIR=$(dirname "$(pwd)/artifacts" 2>/dev/null || echo ".")
                 # Or find it from PROGRESS.yaml location
                 PROGRESS_FILE=$(find .claude/sprints -name "PROGRESS.yaml" -newer .claude/sprints/*/SPRINT.yaml 2>/dev/null | head -1)
                 ```

              3. Insert fix + verify phases using yq:
                 ```bash
                 # Add fix-qa and verify-qa phases after the current qa phase
                 yq -i '
                   (.phases[] | select(.steps) | .steps[] | select(.status == "in-progress")).phases +=
                   [
                     {
                       "id": "fix-qa",
                       "status": "pending",
                       "prompt": "Fix the QA issues identified in artifacts/step-11-qa-report.md.\n\nInstructions:\n1. Read the QA report carefully\n2. Fix each identified issue\n3. Re-run the failed checks to confirm fixes\n4. Update artifacts/step-11-qa-report.md with fix status"
                     },
                     {
                       "id": "verify-qa",
                       "status": "pending",
                       "prompt": "Verify all QA issues from step-11 are resolved.\n\nRe-run ALL checks from the original QA:\n- TypeScript build (if applicable)\n- Script validation (if applicable)\n- Integration verification\n- Smoke test\n\nUpdate artifacts/step-11-qa-report.md with final PASS status.\nIf still failing, inject another fix-qa phase."
                     }
                   ]
                 ' "$PROGRESS_FILE"
                 ```

              4. Mark current QA phase as failed:
                 ```bash
                 yq -i '
                   (.. | select(.id == "qa" and .status == "in-progress")) |=
                   (.status = "failed" | .error = "QA failed - see artifacts/step-11-qa-report.md - fix-qa phase added")
                 ' "$PROGRESS_FILE"
                 ```

              5. The sprint loop will now execute:
                 - fix-qa → fixes the issues
                 - verify-qa → confirms fixes work

              ## Important
              - Focus on compilation and integration (no unit test suite yet)
              - Reference context/sprint-plan.md for acceptance criteria
              - QA failures MUST result in injected fix tasks, not just reports
    started-at: "2026-01-16T10:35:31Z"
current:
  phase: 1
  step: 2
  sub-phase: 1
stats:
  started-at: "2026-01-16T10:32:56Z"
  total-phases: 26
  completed-phases: 1
  total-steps: 12
  completed-steps: 0
