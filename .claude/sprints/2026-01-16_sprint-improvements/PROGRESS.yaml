sprint-id: 2026-01-16_sprint-improvements
status: paused
phases:
  - id: execute-all
    status: in-progress
    steps:
      - id: step-0
        prompt: |
          Add phase-level timing to the sprint system.

          ## Requirements
          - Track `started-at` and `completed-at` timestamps for each phase
          - Track `elapsed` duration for each phase (format: "HH:MM:SS" or seconds)
          - Update compiler types in `plugins/m42-sprint/compiler/src/types.ts`
          - Update the build-sprint-prompt.sh script to set `started-at` when beginning a phase
          - Update the sprint-loop.sh to calculate and set `elapsed` when phase completes

          ## Files to modify
          - plugins/m42-sprint/compiler/src/types.ts
          - plugins/m42-sprint/scripts/build-sprint-prompt.sh
          - plugins/m42-sprint/scripts/sprint-loop.sh
        status: completed
        phases:
          - id: execute
            status: completed
            prompt: |
              Execute the following task:

              Add phase-level timing to the sprint system.

              ## Requirements
              - Track `started-at` and `completed-at` timestamps for each phase
              - Track `elapsed` duration for each phase (format: "HH:MM:SS" or seconds)
              - Update compiler types in `plugins/m42-sprint/compiler/src/types.ts`
              - Update the build-sprint-prompt.sh script to set `started-at` when beginning a phase
              - Update the sprint-loop.sh to calculate and set `elapsed` when phase completes

              ## Files to modify
              - plugins/m42-sprint/compiler/src/types.ts
              - plugins/m42-sprint/scripts/build-sprint-prompt.sh
              - plugins/m42-sprint/scripts/sprint-loop.sh


              Complete this task fully before marking as done.
            completed-at: "2026-01-16T00:09:27Z"
      - id: step-1
        prompt: |
          Add empty workflow validation to the compiler.

          ## Requirements
          - Fail compilation if a workflow has zero phases
          - Add error code `EMPTY_WORKFLOW` to validation
          - Add validation in `validate.ts` for workflows with empty phases array
          - Write a test case to verify this validation works

          ## Files to modify
          - plugins/m42-sprint/compiler/src/validate.ts
          - plugins/m42-sprint/compiler/src/types.ts (if new error code needed)
        status: completed
        phases:
          - id: execute
            status: completed
            prompt: |
              Execute the following task:

              Add empty workflow validation to the compiler.

              ## Requirements
              - Fail compilation if a workflow has zero phases
              - Add error code `EMPTY_WORKFLOW` to validation
              - Add validation in `validate.ts` for workflows with empty phases array
              - Write a test case to verify this validation works

              ## Files to modify
              - plugins/m42-sprint/compiler/src/validate.ts
              - plugins/m42-sprint/compiler/src/types.ts (if new error code needed)


              Complete this task fully before marking as done.
            started-at: "2026-01-16T00:11:51Z"
            completed-at: "2026-01-16T00:12:00Z"
        started-at: "2026-01-16T00:11:51Z"
      - id: step-2
        prompt: |
          Improve YAML error messages with line numbers and context.

          ## Requirements
          - When SPRINT.yaml or workflow files fail to parse, show:
            - The line number where the error occurred
            - A snippet of the problematic YAML (2-3 lines of context)
            - A clear description of what's wrong
          - Use js-yaml's error properties (mark.line, mark.column, mark.snippet)
          - Update error handling in compile.ts and resolve-workflows.ts

          ## Files to modify
          - plugins/m42-sprint/compiler/src/compile.ts
          - plugins/m42-sprint/compiler/src/resolve-workflows.ts
        status: completed
        phases:
          - id: execute
            status: completed
            prompt: |
              Execute the following task:

              Improve YAML error messages with line numbers and context.

              ## Requirements
              - When SPRINT.yaml or workflow files fail to parse, show:
                - The line number where the error occurred
                - A snippet of the problematic YAML (2-3 lines of context)
                - A clear description of what's wrong
              - Use js-yaml's error properties (mark.line, mark.column, mark.snippet)
              - Update error handling in compile.ts and resolve-workflows.ts

              ## Files to modify
              - plugins/m42-sprint/compiler/src/compile.ts
              - plugins/m42-sprint/compiler/src/resolve-workflows.ts


              Complete this task fully before marking as done.
            started-at: "2026-01-16T00:14:03Z"
            completed-at: "2026-01-16T00:14:03Z"
        started-at: "2026-01-16T00:14:03Z"
      - id: step-3
        prompt: |
          Add pre-flight validation checks before sprint execution.

          ## Requirements
          - Before the sprint loop starts, validate:
            - All referenced workflow files exist
            - PROGRESS.yaml is valid and not corrupted
            - Required tools are available (yq, node, claude CLI)
            - Sprint directory is writable
          - Create a new script `preflight-check.sh` that runs these validations
          - Integrate preflight checks into sprint-loop.sh (run before main loop)
          - Exit with clear error message if any check fails

          ## Files to create/modify
          - plugins/m42-sprint/scripts/preflight-check.sh (new)
          - plugins/m42-sprint/scripts/sprint-loop.sh
        status: pending
        phases:
          - id: execute
            status: pending
            prompt: |
              Execute the following task:

              Add pre-flight validation checks before sprint execution.

              ## Requirements
              - Before the sprint loop starts, validate:
                - All referenced workflow files exist
                - PROGRESS.yaml is valid and not corrupted
                - Required tools are available (yq, node, claude CLI)
                - Sprint directory is writable
              - Create a new script `preflight-check.sh` that runs these validations
              - Integrate preflight checks into sprint-loop.sh (run before main loop)
              - Exit with clear error message if any check fails

              ## Files to create/modify
              - plugins/m42-sprint/scripts/preflight-check.sh (new)
              - plugins/m42-sprint/scripts/sprint-loop.sh


              Complete this task fully before marking as done.
      - id: step-4
        prompt: |
          Make unresolved template variables a compilation error (not warning).

          ## Requirements
          - Change `checkUnresolvedVariables` to return errors, not warnings
          - Add option to compiler CLI: `--strict` that treats warnings as errors
          - By default, keep as warnings for backwards compatibility
          - When --strict is passed, unresolved variables fail compilation
          - Update compiler CLI help text

          ## Files to modify
          - plugins/m42-sprint/compiler/src/validate.ts
          - plugins/m42-sprint/compiler/src/index.ts
          - plugins/m42-sprint/compiler/src/compile.ts
        status: pending
        phases:
          - id: execute
            status: pending
            prompt: |
              Execute the following task:

              Make unresolved template variables a compilation error (not warning).

              ## Requirements
              - Change `checkUnresolvedVariables` to return errors, not warnings
              - Add option to compiler CLI: `--strict` that treats warnings as errors
              - By default, keep as warnings for backwards compatibility
              - When --strict is passed, unresolved variables fail compilation
              - Update compiler CLI help text

              ## Files to modify
              - plugins/m42-sprint/compiler/src/validate.ts
              - plugins/m42-sprint/compiler/src/index.ts
              - plugins/m42-sprint/compiler/src/compile.ts


              Complete this task fully before marking as done.
      - id: step-5
        prompt: |
          Add basic error recovery mechanism for failed phases.

          ## Requirements
          - When a phase fails (Claude CLI returns non-zero), capture the error
          - Add `error` field to phase status in PROGRESS.yaml
          - Add `retry-count` field to track retry attempts
          - Add `--max-retries N` option to sprint-loop.sh (default: 0)
          - If retries exhausted, set status to `blocked` with error details
          - Allow manual retry by resetting phase status to `pending`

          ## Files to modify
          - plugins/m42-sprint/compiler/src/types.ts
          - plugins/m42-sprint/scripts/sprint-loop.sh
          - plugins/m42-sprint/scripts/build-sprint-prompt.sh
        status: pending
        phases:
          - id: execute
            status: pending
            prompt: |
              Execute the following task:

              Add basic error recovery mechanism for failed phases.

              ## Requirements
              - When a phase fails (Claude CLI returns non-zero), capture the error
              - Add `error` field to phase status in PROGRESS.yaml
              - Add `retry-count` field to track retry attempts
              - Add `--max-retries N` option to sprint-loop.sh (default: 0)
              - If retries exhausted, set status to `blocked` with error details
              - Allow manual retry by resetting phase status to `pending`

              ## Files to modify
              - plugins/m42-sprint/compiler/src/types.ts
              - plugins/m42-sprint/scripts/sprint-loop.sh
              - plugins/m42-sprint/scripts/build-sprint-prompt.sh


              Complete this task fully before marking as done.
    started-at: "2026-01-16T00:11:51Z"
current:
  phase: 0
  step: 3
  sub-phase: 0
stats:
  started-at: "2026-01-16T00:06:30Z"
  total-phases: 7
  completed-phases: 0
  total-steps: 6
  completed-steps: 0
