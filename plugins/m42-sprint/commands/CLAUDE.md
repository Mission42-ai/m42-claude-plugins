# Claude Code Configuration - m42-sprint/commands

## Learnings

- **Worktree setup is handled by runtime CLI setupWorktreeIfNeeded, not command skills**: Command skills like `/run-sprint` should NOT manually set up worktrees before launching the runtime CLI. This duplicates logic and can use incorrect paths or versions. The runtime CLI (`runtime/src/cli.ts`) automatically handles worktree setup via `setupWorktreeIfNeeded()` (lines 354-454): loads SPRINT.yaml, checks if worktree needed, resolves paths, creates worktree, copies sprint files, returns target directory. Command skills should: parse arguments, run preflight checks, compile workflow if needed, launch runtime CLI directly (which handles worktree internally), launch status server. Do NOT duplicate worktree setup logic in command skills.

- **Update command documentation when underlying architecture changes**: Commands like /sprint-watch encapsulate specific workflows. When the underlying architecture changes (like status server moving to auto-port), the command's implementation and documentation must update to match. Stale command docs lead to confusion and incorrect usage. Solution: When refactoring changes how a subsystem works, identify affected commands, update implementation to use the subsystem correctly, update documentation to explain new behavior and capabilities, and add examples showing new usage patterns. Commands are the user-facing API - they must stay in sync with internal architecture. Example: Status server now uses auto-port with .status-port file, so /sprint-watch must read JSON port file instead of assuming port 3100, check if server process is still running via PID, document parallel sprint support, and add instructions for launching multiple status servers.
